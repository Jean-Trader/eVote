@using eVote.Core.Application.ViewModels.AllianceRequest
@using eVote.Core.Application.ViewModels.Alliance

@{
    ViewData["Title"] = "Alianzas Políticas";
    Layout = "_LayoutPolitical";
}

@if (ViewBag.ErrorMessage != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @ViewBag.ErrorMessage
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<div class="row">
    <div class="text-center">
        <h1 class="display-4">Alianzas Políticas</h1>
    </div>
</div>

<div class="container border rounded p-4 mb-4" style="margin-top: 20px;">
    <h3 class="text-primary mb-3">Solicitudes Pendientes de Responder</h3>
    <div class="table-responsive">
        <table class="table table-hover text-center align-middle">
            <thead class="table-light">
                <tr>
                    <th>Partido Solicitante</th>
                    <th>Fecha de Solicitud</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @{
                    var pendingRequests = ViewBag.PendingRequests as List<AllianceRequestViewModel>;
                }

                @if (pendingRequests == null || pendingRequests.Count == 0)
                {
                    <tr>
                        <td colspan="3" class="text-center">
                            <h5>No hay solicitudes pendientes</h5>
                        </td>
                    </tr>
                }
                else
                {
                    foreach (var request in pendingRequests)
                    {
                        <tr>
                            <td>@request.RequestingParty?.Name (@request.RequestingParty?.Acronym)</td>
                            <td>@request.RequestDate.ToString("dd/MM/yyyy")</td>
                            <td>
                                <a class="btn btn-outline-success btn-sm me-2" asp-controller="Alliance"
                                   asp-action="AcceptRequest" asp-route-id="@request.Id"> Aceptar </a>
                                <a class="btn btn-outline-danger btn-sm" asp-controller="Alliance"
                                asp-action="RejectRequest" asp-route-id="@request.Id"> Rechazar </a>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>

<div class="container border rounded p-4 mb-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="text-primary mb-0">Solicitudes Realizadas</h3>
        <a class="btn btn-outline-success" asp-controller="Alliance" asp-action="CreateRequest"> Nueva Solicitud </a>
    </div>

    <div class="table-responsive">
        <table class="table table-hover text-center align-middle">
            <thead class="table-light">
                <tr>
                    <th>Partido Destino</th>
                    <th>Fecha de Solicitud</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @{
                    var sentRequests = ViewBag.SentRequests as List<AllianceRequestViewModel>;
                }

                @if (sentRequests == null || sentRequests.Count == 0)
                {
                    <tr>
                        <td colspan="4" class="text-center">
                            <h5>No has enviado solicitudes</h5>
                        </td>
                    </tr>
                }
                else
                {
                    foreach (var request in sentRequests)
                    {
                        <tr>
                            <td>@request.ReceivingParty?.Name (@request.ReceivingParty?.Acronym)</td>
                            <td>@request.RequestDate.ToString("dd/MM/yyyy")</td>
                            <td>
                                <span class="badge bg-@(
                                      request.Status == "Aceptada" ? "success" :
                                      request.Status == "Rechazada" ? "danger" : "warning" )">@request.Status
                                </span>
                       </td>
                      <td>
                        <a class="btn btn-outline-danger btn-sm" asp-controller="Alliance"
                        asp-action="DeleteRequest"asp-route-id="@request.Id">Eliminar</a>
                      </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>

<div class="container border rounded p-4 mb-4">
    <h3 class="text-primary mb-3">Alianzas Activas</h3>
    <div class="table-responsive">
        <table class="table table-hover text-center align-middle">
            <thead class="table-light">
                <tr>
                    <th>Partido Aliado</th>
                    <th>Fecha de Aceptación</th>
                </tr>
            </thead>
            <tbody>
                @{
                    var activeAlliances = ViewBag.ActiveAlliances as List<AllianceViewModel>;
                    var partyId = ViewBag.PartyId;
                }

                @if (activeAlliances == null || activeAlliances.Count == 0)
                {
                    <tr>
                        <td colspan="2" class="text-center">
                            <h5>No tienes alianzas activas</h5>
                        </td>
                    </tr>
                }
                else
                {
                    foreach (var alliance in activeAlliances)
                    {
                        var alliedParty = alliance.Party1Id == partyId ? alliance.Party2 : alliance.Party1;

                        <tr>
                            <td>@alliedParty?.Name (@alliedParty?.Acronym)</td>
                            <td>@alliance.AcceptedDate.ToString("dd/MM/yyyy")</td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>
